
@if (paper(); as qp) {
  <div class="w-full max-w-6xl mx-auto flex flex-col items-center">
    <div class="text-center mb-4 bg-white p-3 rounded-lg shadow-md">
      <h1 class="text-xl font-bold text-gray-800">{{ qp.subject }}</h1>
      <p class="text-gray-600">Student: {{ paperService.studentName() }}</p>
    </div>

    <div class="book-container w-full aspect-[2/1.414]">
      <div class="book">
        @for(page of qp.pages; track page.pageNumber) {
          <div 
            class="page" 
            [class.flipped]="currentPage() > page.pageNumber"
            [style.z-index]="qp.totalPages - page.pageNumber">
            <div class="page-front">
              <app-page [page]="page"></app-page>
            </div>
            <div class="page-back">
              @if(page.pageNumber + 1 <= qp.totalPages) {
                <app-page [page]="qp.pages[page.pageNumber]"></app-page>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <div class="flex justify-between w-full max-w-4xl mt-6">
      <button (click)="flipPrev()" [disabled]="currentPage() <= 1" class="px-6 py-2 bg-white rounded-md shadow-lg font-semibold text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
        &larr; Previous
      </button>
      <div class="text-lg font-semibold text-gray-700 flex items-center">
        Page {{ currentPage() === 1 ? '1' : (currentPage() - 1) + ' - ' + currentPage() }} of {{ totalPages() }}
      </div>
      <button (click)="flipNext()" [disabled]="currentPage() >= totalPages()" class="px-6 py-2 bg-white rounded-md shadow-lg font-semibold text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
        Next &rarr;
      </button>
    </div>

    <button 
      (click)="saveAndExit()"
      class="mt-6 px-8 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-xl hover:bg-indigo-700 transition-colors">
        @if (isSaving()) {
          <span class="animate-pulse">Saving...</span>
        } @else {
          <span>Save & Exit</span>
        }
    </button>

  </div>
} @else {
  <p class="text-center text-xl">Loading paper...</p>
}
